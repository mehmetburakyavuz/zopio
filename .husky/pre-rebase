#!/usr/bin/env sh

echo "ğŸ”„ Running pre-rebase checks..."
echo "â„¹ï¸  This hook ensures code quality before rebasing"

# Run Turbo lint on affected packages
echo "ğŸ” Running turbo affected lint..."
echo "   - Linting only packages affected by your changes"
pnpm turbo run lint --filter=...[HEAD^1] && {
  echo "   âœ“ Affected packages lint passed"
} || {
  echo "âŒ Turbo lint failed"
  echo "   Please fix linting issues before rebasing"
  exit 1
}

# Run type checking on the entire project (temporary disabled)
#echo "ğŸ” Running type check..."
#echo "   - Verifying TypeScript types across the project"
#pnpm typecheck && {
#  echo "   âœ“ TypeScript type check passed"
#} || {
#  echo "âŒ Type checking failed"
#  echo "   Please fix type errors before rebasing"
#  exit 1
#}

# Run unit tests
echo "ğŸ§ª Running unit tests..."
echo "   - Verifying that all tests pass before rebasing"
pnpm test --changed && {
  echo "   âœ“ All tests passed successfully"
} || {
  echo "âŒ Tests failed"
  echo "   Please fix failing tests before rebasing"
  exit 1
}

echo "âœ… All pre-rebase checks passed!"
echo "   Your code is ready to be rebased"
